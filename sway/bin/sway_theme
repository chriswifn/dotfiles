#!/bin/bash

# Description:  Script to change between a light and dark theme in swaywm and
#               programs that I use.
#               Heavily inspired by https://git.sr.ht/~protesilaos/dotfiles/tree/master/item/bin/bin/delight
#               This is a worse version so checkout Protesilaos Stavrous version
# Dependencies: Script doesn't execute that parts that have missing dependencies
# Author:       Christian Hageloch


# Check command 
_depcheck() {
    command -v "$1" > /dev/null || { echo "Missing dependency: $1."; return 1; }
}

# for managing dotfiles with GNU Stow
_sed() {
    sed --follow-symlinks -i "$@"
}

# Alacritty
_alacritty() {
    _depcheck alacritty
    _ALACRITTY_CONFIG="$HOME"/.config/alacritty/active-theme.yml
    case "$_STYLE" in
        dark) _sed "s/light/dark/" "$_ALACRITTY_CONFIG" ;;
        light) _sed "s/dark/light/" "$_ALACRITTY_CONFIG" ;;
    esac
}

_tofi() {
    _depcheck tofi
    _TOFI_CONFIG="$HOME"/.config/tofi/config
    case "$_STYLE" in
        dark) _sed "s/light/dark/" "$_TOFI_CONFIG" ;;
        light) _sed "s/dark/light/" "$_TOFI_CONFIG" ;;
    esac
}

_neovim() {
    _depcheck nvim
    _NVIM_CONFIG="$HOME"/.config/nvim/lua/plugins/colorscheme.lua
    case "$_STYLE" in
        dark) _sed "s/light/dark/" "$_NVIM_CONFIG" ;;
        light) _sed "s/dark/light/" "$_NVIM_CONFIG";;
    esac
}

_ggtk() {
    gsettings "$1" org.gnome.desktop.interface gtk-theme "${@:2}"
}

_gcolor_scheme() {
    gsettings "$1" org.gnome.desktop.interface color-scheme "${@:2}"
}

# Get the GTK theme
_ggtk_get() {
    _ggtk 'get'
}

# Set the GTK theme
_ggtk_set() {
    _ggtk 'set' "$1"
}

# Get the Color Scheme
_gcolor_scheme_get() {
    _gcolor_scheme 'get'
}

# Set the Color Scheme
_gcolor_scheme_set() {
    _gcolor_scheme 'set' "$1"
}

_gtheme () {
    _depcheck gsettings

    if [ "$_STYLE" = "dark" ]; then
        _ggtk_set 'Adwaita-dark'
        _gcolor_scheme_set 'prefer-dark'
    else
        _ggtk_set 'Adwaita'
        _gcolor_scheme_set 'prefer-light'
    fi
}

# main part
_depcheck sway
_WM_THEME="$HOME"/.config/sway/active-theme
case "$(cat "$_WM_THEME")" in
    light)
        _STYLE="dark"
        echo "$_STYLE" > "$_WM_THEME"

        swaymsg client.focused "#000000" "#000000" "#000000" "#ff8059" "#79a8ff"
        swaymsg client.unfocused "#000000" "#000000" "#000000" "#000000" "#000000"
        swaymsg client.focused_inactive "#000000" "#000000" "#000000" "#000000" "#000000"
	;;
    dark)
        _STYLE="light"
        echo "$_STYLE" > "$_WM_THEME"

        swaymsg client.focused "#ffffff" "#ffffff" "#ffffff" "#a60000" "#354fcf"
        swaymsg client.unfocused "#ffffff" "#ffffff" "#ffffff" "#ffffff" "#ffffff"
        swaymsg client.focused_inactive "#ffffff" "#ffffff" "#ffffff" "#ffffff" "#ffffff"
	;;
esac
_alacritty
_tofi
_neovim
_gtheme
