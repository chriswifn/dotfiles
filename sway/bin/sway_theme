#!/bin/bash

# Description:  Script to change between a light and dark theme in swaywm and
#               programs that I use.
#               Heavily inspired by https://git.sr.ht/~protesilaos/dotfiles/tree/master/item/bin/bin/delight
#               This is a worse version so checkout Protesilaos Stavrous version
# Dependencies: Script doesn't execute that parts that have missing dependencies
# Author:       Christian Hageloch


# Check command 
_depcheck() {
    command -v "$1" > /dev/null || { echo "Missing dependency: $1."; return 1; }
}

# for managing dotfiles with GNU Stow
_sed() {
    sed --follow-symlinks -i "$@"
}

# Alacritty
_alacritty() {
    _depcheck alacritty
    _ALACRITTY_CONFIG="$HOME"/.config/alacritty/modus-themes-active.yml
    case "$_STYLE" in
	modus-operandi) _sed "s/vivendi/operandi/" "$_ALACRITTY_CONFIG" ;;
	modus-vivendi) _sed "s/operandi/vivendi/" "$_ALACRITTY_CONFIG" ;;
    esac
}

# Neovim
_neovim() {
    _depcheck nvim
    _NVIM_CONFIG="$HOME"/.config/nvim/after/plugin/colors.lua
    case "$_STYLE" in
	modus-operandi) _sed 's/vim.o.background = "dark"/vim.o.background = "light"/' "$_NVIM_CONFIG";;
	modus-vivendi) _sed 's/vim.o.background = "light"/vim.o.background = "dark"/' "$_NVIM_CONFIG";;
    esac
}

_tofi() {
    _depcheck tofi
    _TOFI_CONFIG="$HOME"/.config/tofi/config
    case "$_STYLE" in
	modus-operandi) _sed "s/vivendi/operandi/" "$_TOFI_CONFIG" ;;
	modus-vivendi) _sed "s/operandi/vivendi/" "$_TOFI_CONFIG" ;;
    esac
}

# Emacs
_emacs() {
    _depcheck emacs
    pgrep -x emacs > /dev/null || return 1
    emacsclient -e "(modus-themes-load-theme '${_STYLE})" > /dev/null
}

_ggtk() {
    gsettings "$1" org.gnome.desktop.interface gtk-theme "${@:2}"
}

_gcolor_scheme() {
    gsettings "$1" org.gnome.desktop.interface color-scheme "${@:2}"
}

# Get the GTK theme
_ggtk_get() {
    _ggtk 'get'
}

# Set the GTK theme
_ggtk_set() {
    _ggtk 'set' "$1"
}

# Get the Color Scheme
_gcolor_scheme_get() {
    _gcolor_scheme 'get'
}

# Set the Color Scheme
_gcolor_scheme_set() {
    _gcolor_scheme 'set' "$1"
}

_gtheme () {
    _depcheck gsettings

    if [ "$_STYLE" = "modus-vivendi" ]; then
        _ggtk_set 'Adwaita-dark'
        _gcolor_scheme_set 'prefer-dark'
    else
        _ggtk_set 'Adwaita'
        _gcolor_scheme_set 'prefer-light'
    fi
}

# main part
_depcheck sway
_WM_THEME="$HOME"/.config/sway/active-theme
case "$(cat "$_WM_THEME")" in
    modus-operandi)
        _STYLE="modus-vivendi"
        echo "$_STYLE" > "$_WM_THEME"

        swaymsg client.focused '#535353' '#535353' '#ffffff' '#ff5f59' '#79a8ff'
        swaymsg client.unfocused '#303030' '#303030' '#989898' '#535353' '#535353'

        swaymsg bar 0 colors background '#000000'
        swaymsg bar 0 colors statusline '#ffffff'
        swaymsg bar 0 colors binding_mode '#ff8f88' '#ff8f88' '#000000'
        swaymsg bar 0 colors focused_workspace '#aaaaaa' '#efefef' '#000000'
        swaymsg bar 0 colors inactive_workspace '#ffffff' '#ffffff' '#505050'
	;;
    modus-vivendi)
        _STYLE="modus-operandi"
        echo "$_STYLE" > "$_WM_THEME"

        swaymsg client.focused "#c4c4c4" "#c4c4c4" "#000000" "#a60000" "#354fcf"
        swaymsg client.unfocused "#e0e0e0" "#e0e0e0" "#585858" "#c4c4c4" "#c4c4c4"

        swaymsg bar 0 colors background '#ffffff'
        swaymsg bar 0 colors statusline '#000000'
        swaymsg bar 0 colors binding_mode '#cd2f30' '#cd2f30' '#ffffff'
        swaymsg bar 0 colors focused_workspace '#535353' '#303030' '#ffffff'
        swaymsg bar 0 colors inactive_workspace '#000000' '#000000' '#989898'
	;;
esac
_alacritty
_tofi
_emacs
_neovim
_gtheme



